[
  {
    "name": "${project}-${environment}-container",
    "image": "${image}",
    "cpu": 1024,
    "memory": 2048,
    "essential": true,
    "environment" : [
      { "name" : "PORT", "value" : "${container_port}" },
      { "name" : "ENV", "value" : "${environment}" },
      { "name" : "KEYCLOAK_URL", "value" : "${keycloak_url}" },
      { "name" : "KEYCLOAK_REALM", "value" : "${keycloak_realm}" },
      { "name" : "MOCK_KEY_MANAGER", "value" : "${mock_key_manager}" },
      { "name" : "KEY_MANAGER_URL", "value" : "${key_manager_url}" },
      { "name" : "FENCE_LIST", "value" : "${fence_list}" },
      { "name" : "FHIR_URL", "value" : "${fhir_url}" },
      { "name" : "FHIR_KEYCLOAK_URL", "value" : "${fhir_keycloak_url}" },
      { "name" : "FHIR_KEYCLOAK_REALM", "value" : "${fhir_keycloak_realm}" },
      { "name" : "MANIFEST_BUCKET", "value" : "${manifest_bucket}" }
    ],
    "entryPoint": [
       "node"
    ],
    "command" : [
      "./dist/src/index.js"
    ],
    "startPeriod": 300,
    "secrets" : [
      { 
        "name" : "KEYCLOAK_CLIENT", 
        "valueFrom" : "${secret_name}:KEYCLOAK_CLIENT::"
      },
      {
        "name" : "FHIR_KEYCLOAK_CLIENT_ID", 
        "valueFrom" : "${secret_name}:FHIR_KEYCLOAK_CLIENT_ID::"
      },
      {
        "name" : "FHIR_KEYCLOAK_CLIENT_SECRET", 
        "valueFrom" : "${secret_name}:FHIR_KEYCLOAK_CLIENT_SECRET::"
      }
    ],
    "healthCheckGracePeriodSeconds": 600,
    "portMappings": [
      {
        "containerPort": ${container_port},
        "hostPort": ${container_port},
        "protocol": "tcp"
      }
    ]
    ,"logConfiguration": {
        "logDriver": "awslogs",
        "options": {
            "awslogs-group": "${log_group_name}",
            "awslogs-region": "${region}",
            "awslogs-stream-prefix": "${log_group_name}"
        }
    },
    "ulimits": [
      {
        "softLimit": 1024000,
        "hardLimit": 1024000,
        "name": "nofile"
      }
    ]
  }
]
